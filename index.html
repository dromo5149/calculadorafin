<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NORLAB - Calculadora Financiera</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
:root {
  --azul-principal: #2D7EA8;
  --azul-norlab: #2A5870;
  --azul-profundo: #1A3A4A;
  --azul-claro: #D6EAF5;
  --teal: #4AB8C8;
  --fondo-icono: #E8EEF5;
  --tinta: #0F2430;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #f8fafc 0%, #e8eef5 100%);
  color: var(--tinta);
  line-height: 1.5;
  font-size: 14px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* Header para pantalla */
.header-screen {
  background: white;
  padding: 24px 32px;
  border-radius: 12px;
  margin-bottom: 24px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.header-screen .header-logo {
  display: flex;
  align-items: center;
  gap: 16px;
}

.header-screen .header-logo img {
  height: 45px;
  width: auto;
}

.header-screen .header-info h1 {
  font-family: 'Playfair Display', serif;
  color: var(--azul-norlab);
  font-size: 22px;
  margin-bottom: 4px;
  font-weight: 700;
}

.header-screen .header-info p {
  color: #6b7c93;
  font-size: 13px;
}

.print-btn {
  background: var(--azul-norlab);
  color: white;
  border: none;
  padding: 11px 22px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
}

.print-btn:hover {
  background: var(--azul-profundo);
  transform: translateY(-1px);
}

/* Header para impresión PDF */
.header-print {
  display: none;
  background: white;
  padding: 20px 30px;
  border-bottom: 3px solid var(--azul-norlab);
  margin-bottom: 20px;
}

.header-print-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.header-print-left {
  display: flex;
  align-items: center;
  gap: 20px;
}

.header-print-left img {
  height: 50px;
  width: auto;
}

.header-print-info h1 {
  font-family: 'Playfair Display', serif;
  color: var(--azul-norlab);
  font-size: 20px;
  margin-bottom: 3px;
}

.header-print-info p {
  color: #6b7c93;
  font-size: 11px;
}

.header-print-right {
  text-align: right;
  font-size: 10px;
  color: #6b7c93;
  line-height: 1.4;
}

.header-print-footer {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #e8edf5;
  font-size: 9px;
  color: #6b7c93;
  text-align: center;
}

/* Tabs */
.tabs {
  display: flex;
  background: white;
  border-radius: 10px;
  padding: 5px;
  margin-bottom: 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.tab {
  flex: 1;
  padding: 10px 16px;
  background: none;
  border: none;
  border-radius: 7px;
  font-size: 13px;
  font-weight: 600;
  color: #6b7c93;
  cursor: pointer;
  transition: all 0.2s;
  font-family: inherit;
}

.tab.active {
  background: var(--azul-norlab);
  color: white;
  box-shadow: 0 2px 6px rgba(42, 88, 112, 0.25);
}

/* Calculator Card */
.calc-card {
  background: white;
  border-radius: 12px;
  padding: 32px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  margin-bottom: 24px;
}

.calc-title {
  font-family: 'Playfair Display', serif;
  font-size: 20px;
  color: var(--azul-norlab);
  margin-bottom: 6px;
  font-weight: 700;
}

.calc-subtitle {
  color: #6b7c93;
  margin-bottom: 24px;
  font-size: 13px;
}

/* Form Groups */
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 18px;
  margin-bottom: 24px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 7px;
}

.form-group label {
  font-size: 11px;
  font-weight: 600;
  color: var(--azul-norlab);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.form-group input,
.form-group select {
  padding: 10px 14px;
  border: 2px solid #e8edf5;
  border-radius: 7px;
  font-size: 14px;
  font-family: inherit;
  font-weight: 500;
  transition: all 0.2s;
  background: white;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--azul-norlab);
  box-shadow: 0 0 0 3px rgba(42, 88, 112, 0.08);
}

.form-group input[type="number"] {
  text-align: right;
}

/* Results Section */
.results {
  background: linear-gradient(135deg, var(--azul-norlab) 0%, var(--azul-profundo) 100%);
  border-radius: 10px;
  padding: 24px;
  color: white;
  margin-top: 24px;
}

.results-title {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--azul-claro);
  margin-bottom: 18px;
}

.result-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.result-row:last-child {
  border-bottom: none;
}

.result-label {
  font-size: 13px;
  color: rgba(255,255,255,0.8);
}

.result-value {
  font-size: 16px;
  font-weight: 700;
}

.result-value.highlight {
  font-size: 26px;
  color: var(--teal);
}

/* Breakdown Table */
.breakdown {
  margin-top: 24px;
  background: var(--fondo-icono);
  border-radius: 10px;
  overflow: hidden;
}

.breakdown-title {
  background: var(--azul-norlab);
  color: white;
  padding: 12px 18px;
  font-weight: 700;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.breakdown-table {
  width: 100%;
  border-collapse: collapse;
}

.breakdown-table th,
.breakdown-table td {
  padding: 10px 18px;
  text-align: left;
  font-size: 12px;
}

.breakdown-table th {
  background: white;
  font-weight: 700;
  color: var(--azul-norlab);
  border-bottom: 2px solid var(--azul-claro);
}

.breakdown-table tr:nth-child(even) {
  background: white;
}

.breakdown-table td {
  color: var(--tinta);
}

.breakdown-table td:last-child {
  text-align: right;
  font-weight: 600;
}

/* Amortization Table */
.amortization {
  margin-top: 24px;
  page-break-inside: avoid;
}

.amortization-title {
  background: var(--azul-norlab);
  color: white;
  padding: 12px 18px;
  font-weight: 700;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: 10px 10px 0 0;
}

.amortization-table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 0 0 10px 10px;
  overflow: hidden;
}

.amortization-table th {
  background: var(--fondo-icono);
  color: var(--azul-norlab);
  padding: 10px 12px;
  text-align: center;
  font-size: 11px;
  font-weight: 700;
  border-bottom: 2px solid var(--azul-claro);
}

.amortization-table td {
  padding: 8px 12px;
  text-align: right;
  font-size: 11px;
  border-bottom: 1px solid #f0f0f0;
}

.amortization-table tr:nth-child(even) {
  background: #fafbfc;
}

.amortization-table tr:hover {
  background: #f5f8fa;
}

.amortization-table td:first-child {
  text-align: center;
  font-weight: 600;
  color: var(--azul-norlab);
}

.amortization-table tr:last-child {
  font-weight: 700;
  background: var(--azul-claro);
}

/* Notes */
.notes {
  background: #fffbeb;
  border-left: 4px solid #f59e0b;
  padding: 16px;
  border-radius: 7px;
  margin-top: 24px;
}

.notes-title {
  font-weight: 700;
  color: #92400e;
  margin-bottom: 8px;
  font-size: 12px;
}

.notes ul {
  list-style: none;
  padding: 0;
}

.notes li {
  color: #78350f;
  font-size: 11px;
  margin-bottom: 5px;
  padding-left: 16px;
  position: relative;
}

.notes li:before {
  content: "•";
  position: absolute;
  left: 0;
  color: #f59e0b;
  font-weight: bold;
}

/* Print Styles */
@media print {
  @page {
    margin: 15mm;
  }

  body {
    background: white;
    font-size: 10pt;
  }
  
  .container {
    max-width: 100%;
    padding: 0;
  }
  
  .header-screen,
  .print-btn,
  .tabs,
  .notes {
    display: none !important;
  }

  .header-print {
    display: block !important;
  }
  
  .calc-card {
    box-shadow: none;
    page-break-inside: avoid;
    padding: 15px;
  }

  .calc-title {
    font-size: 16pt;
    margin-bottom: 5px;
  }

  .calc-subtitle {
    font-size: 10pt;
    margin-bottom: 15px;
  }

  .form-grid {
    display: none !important;
  }
  
  .results {
    page-break-inside: avoid;
    border: 2px solid var(--azul-norlab);
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
  }

  .breakdown,
  .amortization {
    page-break-inside: avoid;
    margin-top: 15px;
  }

  .breakdown-table th,
  .amortization-table th {
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
  }
}

@media (max-width: 768px) {
  .header-screen {
    flex-direction: column;
    text-align: center;
    gap: 16px;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .tabs {
    flex-direction: column;
  }
  
  .result-value.highlight {
    font-size: 20px;
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- Header para pantalla -->
  <div class="header-screen">
    <div class="header-logo">
      <img src="https://raw.githubusercontent.com/RohmnosGrupo/financiamiento-norlab/main/norlab_logo_azul_transp.png" alt="NORLAB">
      <div class="header-info">
        <h1>Calculadora Financiera</h1>
        <p>Simula tu inversión en equipo médico</p>
      </div>
    </div>
    <button class="print-btn" onclick="window.print()">
      <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path d="M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"></path>
        <path d="M6 14h12v8H6z"></path>
      </svg>
      Imprimir / PDF
    </button>
  </div>

  <!-- Header para impresión PDF -->
  <div class="header-print">
    <div class="header-print-content">
      <div class="header-print-left">
        <img src="https://raw.githubusercontent.com/RohmnosGrupo/financiamiento-norlab/main/norlab_logo_azul_transp.png" alt="NORLAB">
        <div class="header-print-info">
          <h1>Simulación de Financiamiento</h1>
          <p>Equipamiento médico y diagnóstico</p>
        </div>
      </div>
      <div class="header-print-right">
        <strong>Grupo Rohmnos S. de R.L. de C.V.</strong><br>
        RFC: GRO1903139Z6<br>
        C. 8 de Mayo 9, Manuel Ávila Camacho<br>
        Naucalpan de Juárez, 53910, Estado de México<br>
        Teléfono: 56 2183 6094 | info@norlab.xyz
      </div>
    </div>
    <div class="header-print-footer">
      Generado: <span id="print-date"></span> | Precios en M.N. - Incluyen 16% de IVA | Sujetos a cambio sin previo aviso | Simulación informativa
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('financiamiento')">Financiamiento</button>
    <button class="tab" onclick="switchTab('renta')">Renta</button>
    <button class="tab" onclick="switchTab('comodato')">Comodato</button>
  </div>

  <!-- FINANCIAMIENTO -->
  <div id="financiamiento" class="calc-card">
    <h2 class="calc-title">Financiamiento</h2>
    <p class="calc-subtitle">Adquiere el equipo en pagos fijos. Es tuyo al finalizar.</p>

    <div class="form-grid">
      <div class="form-group">
        <label>Precio del equipo (SIN IVA)</label>
        <input type="number" id="fin_precio" value="184338" oninput="calcFinanciamiento()" step="1000">
      </div>
      <div class="form-group">
        <label>Instalación + Capacitación (SIN IVA)</label>
        <input type="number" id="fin_instalacion" value="15000" oninput="calcFinanciamiento()" step="1000">
      </div>
      <div class="form-group">
        <label>Porcentaje de enganche</label>
        <select id="fin_enganche" onchange="calcFinanciamiento()">
          <option value="0.20">20%</option>
          <option value="0.25">25%</option>
          <option value="0.30" selected>30%</option>
          <option value="0.35">35%</option>
          <option value="0.40">40%</option>
          <option value="0.50">50%</option>
        </select>
      </div>
      <div class="form-group">
        <label>Plazo (meses)</label>
        <select id="fin_plazo" onchange="calcFinanciamiento()">
          <option value="6">6 meses</option>
          <option value="12" selected>12 meses</option>
          <option value="18">18 meses</option>
          <option value="24">24 meses</option>
          <option value="36">36 meses</option>
          <option value="48">48 meses</option>
        </select>
      </div>
    </div>

    <div class="results">
      <div class="results-title">Resumen para el Cliente</div>
      <div class="result-row">
        <span class="result-label">Enganche a pagar (CON IVA)</span>
        <span class="result-value highlight" id="fin_result_enganche">$0.00</span>
      </div>
      <div class="result-row">
        <span class="result-label">Mensualidad (CON IVA)</span>
        <span class="result-value highlight" id="fin_result_mensualidad">$0.00</span>
      </div>
      <div class="result-row">
        <span class="result-label">Plazo</span>
        <span class="result-value" id="fin_result_plazo">12 meses</span>
      </div>
      <div class="result-row">
        <span class="result-label">Total a pagar</span>
        <span class="result-value" id="fin_result_total">$0.00</span>
      </div>
    </div>

    <div class="breakdown">
      <div class="breakdown-title">Desglose del Cálculo</div>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>Concepto</th>
            <th style="text-align: right;">Monto</th>
          </tr>
        </thead>
        <tbody id="fin_breakdown"></tbody>
      </table>
    </div>

    <!-- Tabla de Amortización -->
    <div class="amortization" id="amortization-table">
      <div class="amortization-title">Tabla de Amortización</div>
      <table class="amortization-table">
        <thead>
          <tr>
            <th>Mes</th>
            <th>Mensualidad</th>
            <th>Intereses</th>
            <th>Capital</th>
            <th>Saldo</th>
          </tr>
        </thead>
        <tbody id="amortization-body"></tbody>
      </table>
    </div>

    <div class="notes">
      <div class="notes-title">Notas Importantes:</div>
      <ul>
        <li>El precio del equipo NO incluye IVA - se calcula por separado</li>
        <li>El enganche se calcula sobre el total SIN IVA, luego se le suma IVA</li>
        <li>Las mensualidades incluyen intereses del 2% mensual + IVA</li>
        <li>El equipo es propiedad del cliente al finalizar los pagos</li>
      </ul>
    </div>
  </div>

  <!-- RENTA -->
  <div id="renta" class="calc-card" style="display:none;">
    <h2 class="calc-title">Renta Mensual</h2>
    <p class="calc-subtitle">Renta mensual fija. Incluye mantenimiento preventivo. Plazo mínimo 3 años.</p>

    <div class="form-grid">
      <div class="form-group">
        <label>Precio del equipo (SIN IVA)</label>
        <input type="number" id="ren_precio" value="184338" oninput="calcRenta()" step="1000">
      </div>
      <div class="form-group">
        <label>Instalación + Capacitación (SIN IVA)</label>
        <input type="number" id="ren_instalacion" value="15000" oninput="calcRenta()" step="1000">
      </div>
      <div class="form-group">
        <label>Plazo (meses)</label>
        <select id="ren_plazo" onchange="calcRenta()">
          <option value="36" selected>36 meses (3 años)</option>
          <option value="48">48 meses (4 años)</option>
          <option value="60">60 meses (5 años)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Tasa mensual</label>
        <select id="ren_tasa" onchange="calcRenta()">
          <option value="0.04" selected>4% mensual</option>
          <option value="custom">Recuperar en mes 22</option>
        </select>
      </div>
    </div>

    <div class="results">
      <div class="results-title">Resumen para el Cliente</div>
      <div class="result-row">
        <span class="result-label">Pago inicial (depósito + instalación)</span>
        <span class="result-value highlight" id="ren_result_inicial">$0.00</span>
      </div>
      <div class="result-row">
        <span class="result-label">Renta mensual (CON IVA)</span>
        <span class="result-value highlight" id="ren_result_mensualidad">$0.00</span>
      </div>
      <div class="result-row">
        <span class="result-label">Plazo mínimo forzoso</span>
        <span class="result-value" id="ren_result_plazo">36 meses</span>
      </div>
      <div class="result-row">
        <span class="result-label">Mantenimiento preventivo</span>
        <span class="result-value">Incluido ✓</span>
      </div>
    </div>

    <div class="breakdown">
      <div class="breakdown-title">Desglose del Cálculo</div>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>Concepto</th>
            <th style="text-align: right;">Monto</th>
          </tr>
        </thead>
        <tbody id="ren_breakdown"></tbody>
      </table>
    </div>

    <div class="notes">
      <div class="notes-title">Notas Importantes:</div>
      <ul>
        <li>Plazo mínimo forzoso de 3 años para cualquier equipo en renta</li>
        <li>Sin enganche, solo depósito recuperable (3 meses de renta)</li>
        <li>Instalación se paga junto con el depósito en el primer pago</li>
        <li>Incluye mantenimiento preventivo sin costo adicional</li>
        <li>El equipo NO es propiedad del cliente, se devuelve al finalizar</li>
      </ul>
    </div>
  </div>

  <!-- COMODATO -->
  <div id="comodato" class="calc-card" style="display:none;">
    <h2 class="calc-title">Comodato</h2>
    <p class="calc-subtitle">El equipo se paga con la compra mínima mensual de reactivos. Punto de equilibrio en 24 meses.</p>

    <div class="form-grid">
      <div class="form-group">
        <label>Precio del equipo (SIN IVA)</label>
        <input type="number" id="com_precio" value="184338" oninput="calcComodato()" step="1000">
      </div>
      <div class="form-group">
        <label>Instalación + Capacitación (SIN IVA)</label>
        <input type="number" id="com_instalacion" value="15000" oninput="calcComodato()" step="1000">
      </div>
      <div class="form-group">
        <label>Margen sobre reactivos</label>
        <select id="com_margen" onchange="calcComodato()">
          <option value="0.30">30%</option>
          <option value="0.35" selected>35%</option>
          <option value="0.40">40%</option>
        </select>
      </div>
      <div class="form-group">
        <label>Meses para punto de equilibrio</label>
        <select id="com_plazo" onchange="calcComodato()">
          <option value="24" selected>24 meses</option>
          <option value="36">36 meses</option>
          <option value="48">48 meses</option>
        </select>
      </div>
    </div>

    <div class="results">
      <div class="results-title">Resumen para el Cliente</div>
      <div class="result-row">
        <span class="result-label">Pago inicial (depósito + instalación)</span>
        <span class="result-value highlight" id="com_result_inicial">$0.00</span>
      </div>
      <div class="result-row">
        <span class="result-label">Compra mínima mensual (CON IVA)</span>
        <span class="result-value highlight" id="com_result_mensualidad">$0.00</span>
      </div>
      <div class="result-row">
        <span class="result-label">Plazo de compromiso</span>
        <span class="result-value" id="com_result_plazo">24 meses</span>
      </div>
      <div class="result-row">
        <span class="result-label">Mantenimiento preventivo</span>
        <span class="result-value">Incluido ✓</span>
      </div>
    </div>

    <div class="breakdown">
      <div class="breakdown-title">Desglose del Cálculo</div>
      <table class="breakdown-table">
        <thead>
          <tr>
            <th>Concepto</th>
            <th style="text-align: right;">Monto</th>
          </tr>
        </thead>
        <tbody id="com_breakdown"></tbody>
      </table>
    </div>

    <div class="notes">
      <div class="notes-title">Notas Importantes:</div>
      <ul>
        <li>El equipo se presta sin costo, el cliente paga comprando reactivos</li>
        <li>Depósito recuperable al finalizar el compromiso (2 meses de reactivos)</li>
        <li>Instalación y capacitación se pagan junto con el depósito</li>
        <li>Incluye mantenimiento preventivo sin costo adicional</li>
        <li>El equipo es propiedad de NORLAB, se puede retirar si no se cumple</li>
      </ul>
    </div>
  </div>
</div>

<script>
const fmt = (n) => new Intl.NumberFormat('es-MX', {style:'currency', currency:'MXN', minimumFractionDigits:2}).format(n);

// Fecha para PDF
document.getElementById('print-date').textContent = new Date().toLocaleDateString('es-MX', {
  day: 'numeric',
  month: 'long',
  year: 'numeric'
});

// Switch tabs
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.calc-card').forEach(c => c.style.display = 'none');
  
  event.target.classList.add('active');
  document.getElementById(tab).style.display = 'block';
}

// FINANCIAMIENTO CON TABLA DE AMORTIZACIÓN
function calcFinanciamiento() {
  const precio = parseFloat(document.getElementById('fin_precio').value) || 0;
  const instalacion = parseFloat(document.getElementById('fin_instalacion').value) || 0;
  const engPct = parseFloat(document.getElementById('fin_enganche').value);
  const plazo = parseInt(document.getElementById('fin_plazo').value);
  const tasa = 0.02; // 2% mensual

  // Cálculos SIN IVA
  const totalSinIVA = precio + instalacion;
  const engancheSinIVA = totalSinIVA * engPct;
  const montoFinanciar = totalSinIVA - engancheSinIVA;
  
  // MÉTODO FRANCÉS (Tabla de amortización)
  const factor = Math.pow(1 + tasa, plazo);
  const mensualidadSinIVA = montoFinanciar * (tasa * factor) / (factor - 1);
  const totalMensualidades = mensualidadSinIVA * plazo;
  const intereses = totalMensualidades - montoFinanciar;

  // Agregar IVA
  const engancheConIVA = engancheSinIVA * 1.16;
  const mensualidadConIVA = mensualidadSinIVA * 1.16;
  const totalAPagar = engancheConIVA + (mensualidadConIVA * plazo);

  // Mostrar resultados
  document.getElementById('fin_result_enganche').textContent = fmt(engancheConIVA);
  document.getElementById('fin_result_mensualidad').textContent = fmt(mensualidadConIVA);
  document.getElementById('fin_result_plazo').textContent = plazo + ' meses';
  document.getElementById('fin_result_total').textContent = fmt(totalAPagar);

  // Breakdown
  const breakdown = [
    ['Precio del equipo (SIN IVA)', fmt(precio)],
    ['IVA del equipo (16%)', fmt(precio * 0.16)],
    ['Instalación SIN IVA', fmt(instalacion)],
    ['IVA instalación', fmt(instalacion * 0.16)],
    ['Total a financiar SIN IVA', fmt(totalSinIVA)],
    ['Enganche SIN IVA (' + (engPct*100) + '%)', fmt(engancheSinIVA)],
    ['IVA sobre enganche', fmt(engancheSinIVA * 0.16)],
    ['<strong>Enganche CON IVA</strong>', '<strong>' + fmt(engancheConIVA) + '</strong>'],
    ['Monto a financiar', fmt(montoFinanciar)],
    ['<strong>Mensualidad CON IVA</strong>', '<strong>' + fmt(mensualidadConIVA) + '</strong>'],
    ['Total intereses', fmt(intereses)],
  ];

  document.getElementById('fin_breakdown').innerHTML = breakdown.map(r => 
    `<tr><td>${r[0]}</td><td style="text-align:right">${r[1]}</td></tr>`
  ).join('');

  // Generar tabla de amortización
  generarTablaAmortizacion(montoFinanciar, mensualidadSinIVA, tasa, plazo);
}

function generarTablaAmortizacion(capital, pago, tasa, meses) {
  let saldo = capital;
  let rows = [];
  let totalIntereses = 0;
  let totalCapital = 0;

  for (let mes = 1; mes <= meses; mes++) {
    const interesMes = saldo * tasa;
    const capitalMes = pago - interesMes;
    saldo -= capitalMes;

    // Ajuste para el último mes (evitar saldos negativos por redondeo)
    if (mes === meses) saldo = 0;

    totalIntereses += interesMes;
    totalCapital += capitalMes;

    rows.push(`
      <tr>
        <td>${mes}</td>
        <td>${fmt(pago)}</td>
        <td>${fmt(interesMes)}</td>
        <td>${fmt(capitalMes)}</td>
        <td>${fmt(Math.max(0, saldo))}</td>
      </tr>
    `);
  }

  // Fila de totales
  rows.push(`
    <tr>
      <td><strong>TOTAL</strong></td>
      <td><strong>${fmt(pago * meses)}</strong></td>
      <td><strong>${fmt(totalIntereses)}</strong></td>
      <td><strong>${fmt(totalCapital)}</strong></td>
      <td><strong>$0.00</strong></td>
    </tr>
  `);

  document.getElementById('amortization-body').innerHTML = rows.join('');
}

// RENTA
function calcRenta() {
  const precio = parseFloat(document.getElementById('ren_precio').value) || 0;
  const instalacion = parseFloat(document.getElementById('ren_instalacion').value) || 0;
  const plazo = parseInt(document.getElementById('ren_plazo').value);
  const tasaSelect = document.getElementById('ren_tasa').value;
  
  let rentaMensual;
  if (tasaSelect === 'custom') {
    rentaMensual = precio / 22;
  } else {
    rentaMensual = precio * parseFloat(tasaSelect);
  }

  const rentaConIVA = rentaMensual * 1.16;
  const deposito = rentaMensual * 3;
  const pagoInicial = deposito + (instalacion * 1.16);
  const mantMensual = precio * 0.10 / 12;

  document.getElementById('ren_result_inicial').textContent = fmt(pagoInicial);
  document.getElementById('ren_result_mensualidad').textContent = fmt(rentaConIVA);
  document.getElementById('ren_result_plazo').textContent = plazo + ' meses';

  const breakdown = [
    ['Precio del equipo (SIN IVA)', fmt(precio)],
    ['Renta mensual SIN IVA (4%)', fmt(rentaMensual)],
    ['IVA sobre renta', fmt(rentaMensual * 0.16)],
    ['<strong>Renta mensual CON IVA</strong>', '<strong>' + fmt(rentaConIVA) + '</strong>'],
    ['Depósito (3 meses sin IVA)', fmt(deposito)],
    ['Instalación CON IVA', fmt(instalacion * 1.16)],
    ['<strong>Pago inicial total</strong>', '<strong>' + fmt(pagoInicial) + '</strong>'],
    ['Mantenimiento preventivo (incluido)', fmt(mantMensual)],
  ];

  document.getElementById('ren_breakdown').innerHTML = breakdown.map(r => 
    `<tr><td>${r[0]}</td><td style="text-align:right">${r[1]}</td></tr>`
  ).join('');
}

// COMODATO
function calcComodato() {
  const precio = parseFloat(document.getElementById('com_precio').value) || 0;
  const instalacion = parseFloat(document.getElementById('com_instalacion').value) || 0;
  const margen = parseFloat(document.getElementById('com_margen').value);
  const plazo = parseInt(document.getElementById('com_plazo').value);
  
  const mantMensual = precio * 0.10 / 12;
  const amortMensual = precio / plazo;
  const totalRecuperar = mantMensual + amortMensual;
  const reactivosSinIVA = totalRecuperar / margen;
  const reactivosConIVA = reactivosSinIVA * 1.16;
  const deposito = reactivosSinIVA * 2;
  const pagoInicial = deposito + (instalacion * 1.16);

  document.getElementById('com_result_inicial').textContent = fmt(pagoInicial);
  document.getElementById('com_result_mensualidad').textContent = fmt(reactivosConIVA);
  document.getElementById('com_result_plazo').textContent = plazo + ' meses';

  const breakdown = [
    ['Precio del equipo (SIN IVA)', fmt(precio)],
    ['Mantenimiento preventivo mensual', fmt(mantMensual)],
    ['Amortización mensual equipo', fmt(amortMensual)],
    ['Total a recuperar mensualmente', fmt(totalRecuperar)],
    ['Compra mínima reactivos SIN IVA', fmt(reactivosSinIVA)],
    ['IVA sobre reactivos', fmt(reactivosSinIVA * 0.16)],
    ['<strong>Compra mínima CON IVA</strong>', '<strong>' + fmt(reactivosConIVA) + '</strong>'],
    ['Depósito (2 meses sin IVA)', fmt(deposito)],
    ['Instalación CON IVA', fmt(instalacion * 1.16)],
    ['<strong>Pago inicial total</strong>', '<strong>' + fmt(pagoInicial) + '</strong>'],
  ];

  document.getElementById('com_breakdown').innerHTML = breakdown.map(r => 
    `<tr><td>${r[0]}</td><td style="text-align:right">${r[1]}</td></tr>`
  ).join('');
}

// Calcular al cargar
calcFinanciamiento();
calcRenta();
calcComodato();
</script>

</body>
</html>
